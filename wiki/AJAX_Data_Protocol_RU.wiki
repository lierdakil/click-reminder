#summary Описание протокола обмена сообщениями фронтенда и бэкенда
=Введение=
Система строится на модели запрос-ответ: фронтенд ("клиент") посылает запросы, а бэкенд ("сервер"), в зависимости от данных, полученных в запросе, возвращает соответствующий ситуации ответ или сообщение об ошибке. При этом сервер не может слать запросы клиенту: это ограничение связано с техническими ограничениями парадигмы AJAX.

=Общий формат сообщений=
Запросы ДОЛЖНЫ содержать два параметра: `action` и `sid` (за некоторыми исключениями) и МОГУТ содержать любое число дополнительных параметров.
Параметр `sid` ДОЛЖЕН содержать буквенно-цифровой уникальный идентификатор текущей сессии, переданный клиенту при логине и хранящийся в кукисах.
В параметре `action` СЛЕДУЕТ передавать одну из следующих величин:
 * `login`
 * `logout`
 * `checkSID`
 * `getItemList`
 * `getItemProps`
 * `setItemProps`
 * `addItem`
 * `delItem`
 * `registerUser`
 * `deleteUser`

В зависимости от значения параметра `action`, могут требоваться дополнительные параметры.

==Формат запросов и ожидаемые ответы==

Depending on the request, corresponding reply is formed. Parameters and normal replies are listed in table below. Reply and request are listed in JSON.
Request messages are in JSON and passed in POST body with content-type application/json .
Reply messages are also in JSON and are passed in HTTP body with content-type application/json.

|| Action || Request || Normal reply ||
|| `login` || `{action:login,user:"str",pass:"str")}` || `<sid>` ||
|| `logout` || `{action:logout,sid:<sid>}` || _null_ ||
|| `checkSID` || `{action:checkSID,sid:<sid>}` || _null_ ||
|| `getItemList` || `{action:getItemList,sid:<sid>}` || `[id1,...,idN]`<br>where idN is id of N-th item for a given user ||
|| `getItemProps` || `{action:getItemProps,sid:<sid>,iid:<item_id>,props:[name1,...,nameN]}`<br>where nameN is property name to be acquired || `{name1:"value1",...,nameN:"valueN"}` ||
|| `setItemProps` || `{action:setItemProps,sid:<sid>,iid:<item_id>,props:{name1:"value1",...,nameN:"valueN"}}`<br>where nameN is property name to be set || _null_ ||
|| `addItem` || `{action:addItem,sid:<sid>}` || `<item_id>` ||
|| `delItem` || `{action:delItem,sid:<sid>,iid:<item_id>}` || _null_ ||
|| `registerUser` || `{action:registerUser,user:"str",email:"str",pass:"str"}` || _null_ ||
|| `deleteUser` || `{action:deleteUser,sid:<sid>,user:"str",email:"str",pass:"str"}` || _null_ ||

==Сообщения об ошибках==

Error reporting MAY be done using HTTP status codes. Normal reply is expected if status code is 200 OK, and error report if status is 500 Internal Server Error. Else, client SHOULD throw an error and stop.
Error report reply MUST contain an integer field `errcode`. It also MAY contain one or more additional fields, depending on `errcode` value.
Possible error codes are listed below along with description.

|| Name || Value || Description || 
||ERR_NO_MSG||1||Returned when there is no 'message' parameter in POST||
||ERR_NO_ACT||2||Returned when message does not have 'action' property||
||ERR_LOGIN||3||Returned if login is failed: user/pass do not match or there is no requested user at all||
||ERR_DB||4||Returned whenever there are database problems on server||
||ERR_NO_SID||5||Sid expired, never existed, or was not provided at all||
||ERR_NO_IID||6||No itemID provided||
||ERR_NO_USER||7||No username provided||
||ERR_NO_EMAIL||8||No email provided||
||ERR_NO_PASS||9||No password provided||
||ERR_NO_PROPS||10||No props to set or read specified||
||ERR_USER_EXISTS||11||On registration, such username already exists||
||ERR_DELE_FAIL||12||Failed to delete user. Invalid data most probable||